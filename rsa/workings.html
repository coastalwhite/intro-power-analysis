<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>A deeper look at RSA - Power analysis Introductory Walkthrough</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../preparing.html"><strong aria-hidden="true">2.</strong> Preparing your environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../preparing/python-pip.html"><strong aria-hidden="true">2.1.</strong> Python and Pip</a></li><li class="chapter-item expanded "><a href="../preparing/chipwhisperer.html"><strong aria-hidden="true">2.2.</strong> ChipWhisperer</a></li><li class="chapter-item expanded "><a href="../preparing/toolchains.html"><strong aria-hidden="true">2.3.</strong> Compiling your own algorithms</a></li></ol></li><li class="chapter-item expanded "><a href="../rsa.html"><strong aria-hidden="true">3.</strong> Breaking RSA</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rsa/capture.html"><strong aria-hidden="true">3.1.</strong> Capturing your first trace</a></li><li class="chapter-item expanded "><a href="../rsa/workings.html" class="active"><strong aria-hidden="true">3.2.</strong> A deeper look at RSA</a></li><li class="chapter-item expanded "><a href="../rsa/deciphering.html"><strong aria-hidden="true">3.3.</strong> Deciphering a trace</a></li><li class="chapter-item expanded "><a href="../rsa/exercises.html"><strong aria-hidden="true">3.4.</strong> Exercises</a></li></ol></li><li class="chapter-item expanded "><a href="../aes.html"><strong aria-hidden="true">4.</strong> Breaking AES</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../aes/workings.html"><strong aria-hidden="true">4.1.</strong> How AES works</a></li><li class="chapter-item expanded "><a href="../aes/capture.html"><strong aria-hidden="true">4.2.</strong> Capturing multiple traces</a></li><li class="chapter-item expanded "><a href="../aes/modeling.html"><strong aria-hidden="true">4.3.</strong> Modeling AES</a></li><li class="chapter-item expanded "><a href="../aes/manual-analysis.html"><strong aria-hidden="true">4.4.</strong> Manual analysis</a></li><li class="chapter-item expanded "><a href="../aes/pearson.html"><strong aria-hidden="true">4.5.</strong> Pearson correlation</a></li><li class="chapter-item expanded "><a href="../aes/entire.html"><strong aria-hidden="true">4.6.</strong> Automatically cracking an entire key</a></li><li class="chapter-item expanded "><a href="../aes/optimization.html"><strong aria-hidden="true">4.7.</strong> Sidenote: Optimizing our algorithm</a></li><li class="chapter-item expanded "><a href="../aes/exercises.html"><strong aria-hidden="true">4.8.</strong> Exercises</a></li></ol></li><li class="chapter-item expanded "><a href="../assignment.html"><strong aria-hidden="true">5.</strong> Assignment</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Power analysis Introductory Walkthrough</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/coastalwhite/intro-power-analysis" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="a-deeper-look-at-rsa"><a class="header" href="#a-deeper-look-at-rsa">A deeper look at RSA</a></h1>
<p>RSA is quite an simple algorithm, but to understand how and why we can crack RSA
using power traces. It is important to understand the method RSA uses in quite
some depth. In the chapter on AES, we will go a bit deeper into cache based
side-channel attacks and why they work exactly, but here we will do a few
assumptions to focus on the important bits.</p>
<h2 id="what-is-rsa"><a class="header" href="#what-is-rsa">What is RSA?</a></h2>
<p>RSA is used to do asymmetric encryption. This means we have two keys. Most of
the time this means we have one to encrypt plain text to cipher text, one to
decrypt cipher text back to plain text. It is common to have one of these keys
be public and the other be private and secret. Thus, they might also be called
to the public and private key.</p>
<p>RSA uses one simple principle. For encryption with public key \( e \), for
every byte of our plain text \(b_i\) we have encrypted byte \( c_i=b_i^e \)
modulo some integer \( N \). For decryption with private key \( d \), for
every byte of our cipher text \(c_i\) we have encrypted byte \( b_i=c_i^d \)
modulo some integer \( N \). The relationship between these numbers is not as
important for now.</p>
<p>One might wonder how these computations are actually done on the bare hardware.
It turns out that we can interpret this as repeated multiplication and squaring.
This is how that works.</p>
<p>If we are given a number \( x \) and we are tasked with the raising it to the
13th power, we might to it as follows:</p>
<p>\[ x^{13} = x^8 \cdot x^4 \cdot x^1 \]</p>
<p>Noticing the clear ties with powers of 2 here — and thus with binary
—, we might write a custom power function in python as the following.</p>
<pre><code class="language-python"># Custom implementation of pow(x, y)
def custom_pow(x, y):
    res = 1

    # Until we have reached the highest power
    while (y &gt; 0):
        # If the last byte is a one
        if (y &amp; 0x01):
            res *= x

        # Move on to the next byte
        y &gt;&gt;= 1
        x *= x

    return res
</code></pre>
<p>If we add a modulo into our function, we have essentially created a function to
do RSA encryption. This is also often how the pseudocode for lower level
implementation looks like.</p>
<pre><code class="language-python"># Custom implementation of pow(x, y) % p
# With p &gt;= 2
def custom_pow_mod(x, y, p):
    res = 1

    # Until we have reached the highest power
    while (y &gt; 0):
        # If the last byte is a one
        if (y &amp; 0x01):
            res *= x
            res %= p # Make sure we stay modulo p

        # Move on to the next byte
        y &gt;&gt;= 1
        x *= x
        x %= p # Make sure we stay modulo p

    return res
</code></pre>
<p>If you are already a small bit familiar with Side-Channel Analysis and Power
Analysis, you might immediately see what is going wrong here. If not let us go
through it together.</p>
<p>When we do <em>Power Analysis</em>, we get the power consumption of a computer for a
set time. Let us say we would we have a computer purely executing the
computation for <code>custom_pow_mod(3, 5, 15)</code>. The steps that are taken in this
computation are done noted below. Take a look at that the computation and
verify it in your head.</p>
<pre><code class="language-python">custom_pow_mod(3, 5, 15):

res := 1

# Round 1

# [A]
y &gt; 0 = 5 &gt; 0 is true, thus:
    y &amp; 0x01 = 5 &amp; 0x01 is 1, which equals true, thus:
        # [B]
        res := res * x = 1 * 5 = 5
        res := res % 15 = 5 % 15 = 5

    # [C]
    y := y &gt;&gt; 1 = 5 &gt;&gt; 1 = 2
    x := x * x = 3 * 3 = 9
    x := x % 15 = 9 % 15 = 9


# Round 2

# [D]
y &gt; 0 = 2 &gt; 0 is true, thus:
    y &amp; 0x01 = 2 &amp; 0x01 is 0, which equals false

    # [E]
    y := y &gt;&gt; 1 = 2 &gt;&gt; 1 = 1
    x := x * x = 9 * 9 = 81
    x := x % 15 = 81 % 15 = 6

# Round 3

# [F]
y &gt; 0 = 1 &gt; 0 is true, thus:
    y &amp; 0x01 = 1 &amp; 0x01 is 1, which equals true, thus:
        # [G]
        res := res * x = 5 * 6 = 30
        res := res % 15 = 30 % 15 = 0

    # [H]
    y := y &gt;&gt; 1 = 1 &gt;&gt; 1 = 0
    x := x * x = 6 * 6 = 36
    x := x % 15 = 36 % 15 = 6

# Round 4

# [I]
y &gt; 0 = 0 &gt; 0 is false.

# [J]
Result: 0
</code></pre>
<p>One might notice that every round contains a differing amount of steps, and
thus, we might imagine that the power consumption of our machine looks similar
to <em>Figure 1</em>.</p>
<p><img src="../assets/estimate-power-consumption-rsa.jpg" alt="Estimate of RSA power consumption" /></p>
<p><em>Figure 1: A projected power trace for the</em> <code>custom_pow_mod(3, 5, 15)</code> <em>function call.</em></p>
<blockquote>
<p><strong>NOTE:</strong> This sketch uses the estimate that conditionals and loops (<code>if</code> and
<code>while</code>) are less power consuming than normal numerical calculations (<code>&gt;&gt;</code>,
<code>*</code> and <code>%</code>), which isn't trivially necessarily true, but for the sake of
argument we are going to assume it is true.</p>
</blockquote>
<p>You might notice that given this sketch, we can reconstruct some information
about the argument <code>y</code> provided to the <code>custom_pow_mod</code> function. We start with
a long spike, thus, the binary number representation of <code>y</code> starts with a <code>1</code>.
This is followed by a short spike, which indicates a <code>0</code>. And lastly, we see a
long spike again. Therefore, we end with an <code>1</code>. And we get the binary number
<code>101</code> for our <code>y</code>. This equals 5 in decimal, which is correct.</p>
<p>Let us do another one, now without knowing the answer before hand. Take a look
at <em>Figure 2</em>.</p>
<p><img src="../assets/rsa-key-42.jpg" alt="RSA key 42" /></p>
<p><em>Figure 2: A projected power trace for the</em> <code>custom_pow_mod</code> <em>function.</em></p>
<p>We start with two short spikes, and thus we start with two zeros. Then we
alternate a long spike with a short spike three times. This means we get
<code>00101010</code>. This is equal to decimal 42. And thus the <code>y</code> we started with is 42.</p>
<h2 id="what-does-this-tell-us"><a class="header" href="#what-does-this-tell-us">What does this tell us?</a></h2>
<p>The previous code example may seem cherry picked. In fact, it is. It indicates
this concept very nicely and is therefore an extremely good visual example of
how to break a RSA implementation. However, code following the same principle or
even this exact algorithm is extremely common. This means that whilst this exact
method may not be applicable everywhere, the underlaying idea still is.</p>
<p>So whilst this method specifically is interesting, we are more interested in
looking into an algorithm and seeing if we can tell something about data used
from the patterns in a power trace. Specifically for this chapter for (part of)
the RSA encryption algorithm.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../rsa/capture.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../rsa/deciphering.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../rsa/capture.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../rsa/deciphering.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
